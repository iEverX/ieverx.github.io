<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>neovim 插件 denote.nvim</title>
    <link rel="stylesheet" href="https://blog.guolx.com/style.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-webfont/1.6.0/style.min.css" />
</head>


<body>
    <div class="container">
        <div class="block-container">
                
<div id="header" class="header">
    <div class="header-container">
        <div class="brand">
            <h1 class="u-link">
                <a href="https://blog.guolx.com">天外天</a>
            </h1>
        </div>
        



<div class="nav-container">
    <div class="nav">
        
            
                
                
                
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;blog.guolx.com&#x2F;post&#x2F;">archive</a>
    </div>

            
        
            
                
                
                
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;blog.guolx.com&#x2F;arts&#x2F;">arts</a>
    </div>

            
        
            
                
                
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;blog.guolx.com&#x2F;tags">tags</a>
    </div>

            
        
            
                
                
                
                
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;blog.guolx.com&#x2F;message-board&#x2F;">messages</a>
    </div>

            
        
            
                
                
                
                
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;blog.guolx.com&#x2F;pages&#x2F;links&#x2F;">links</a>
    </div>

            
        
            
                
    <div class="u-link nav-item">
        <a href="https:&#x2F;&#x2F;github.com&#x2F;iEverX">github</a>
    </div>

            
        
    </div>
    <div class="clearfix"></div>
</div>



    </div>
</div>

            
<div class="post">    
    <h1 class="post-title">neovim 插件 denote.nvim</h1>
    
<div class="post-meta">
    <span class="post-date">2019-05-03</span>
    
        &middot;
            <span class="post-tag u-link">
                <a href="https://blog.guolx.com/tags/neovim/">#neovim</a>
            </span>
        
    
    
        &middot;
        <span class="word_count">1633 字</span>
        &middot;
        <span class="reading_time">大约需要 9 分钟</span>
    
</div>


    <div class="post-content">
        <h1 id="neovim">neovim</h1>
<p>hyperextensible Vim-based text editor。这是 <a href="https://neovim.io">neovim</a> 官网对其的定义。目前，neovim 仍然在快速迭代，并且现在的版本（v0.3.5）已经可用。neovim 和 vim 在基本使用时兼容的，配置文件也基本是兼容的。因为我不是 vim 重度用 户，所以并没有发现 vim 中可用但是 neovim 中不可用的功能。目前我已经全部切换到 neovim 了。</p>
<h1 id="denite-nvim">denite.nvim</h1>
<p><a href="https://github.com/Shougo/denite.nvim">denite.nvim</a> 是 neovim 的一个插件，在 vim 8 中也能使用。denite.nvim 利用了异步特性，性能相比上一代的unite.vim 有了很大的提升。denite 作者对其的描述是，“Dark powered asynchronous unite all interfaces for Neovim/Vim8”。说实话，从这句话，我是根本没明白这个插件到底做的是啥。不过看到一些推荐这个插件的地方，是用作 fuzzy finder 的，所以还是装了看了下。</p>
<p>简单地说，denite 是给 neovim 中提供了类似于 VSCode、Atom 中类似于 Ctrl-P 的功能。其实也有其他的插件提供类 似的功能，比如 <a href="https://github.com/junegunn/fzf.vim">fzf.vim</a>，<a href="https://github.com/kien/ctrlp.vim">ctrlp.vim</a>。不过我没有用过这些插件，所以本文不会对比。</p>
<p>denite 的配置比较复杂，幸而文档非常完善。denite 中，通过 source 收集不同的可以访问的对象。利用 <code>:Denite</code> 指令，列出 source 收集的对象，进而针对选择的对象，执行不同的操作。</p>
<p>先来个简单的例子，<code>:Denite file/rec</code>，查看当前目录下的所有的文件列表，rec 的意思是递归。所以，也有一个 file 的 source，只会显示当前目录下最顶层的文件。执行命令后，会有一个新的 buffer，列出所有的内容，称为 denite buffer。denite buffer 和普通的 vim buffer 不太一样， 可以认为是一个临时的 buffer。denite buffer 的操作方式和 vim buffer 也是不同的，但是也有两种模式，Insert 和 Normal。执行指令后，默认会进入 Insert 模式，denite 会根据用户的输入，过滤掉不匹配的候选项，默认的匹配方法是 fuzzy match，和 VSCode 中的 Ctrl-P 是一样的。选定候选之后，可以执行不同的操作，比如预览、打开、在另一个 buffer 打开等等。</p>
<h2 id="source">source</h2>
<p>source 是 denite 的核心概念。denite 可选择的候选都是由 source 提供的。简单而言，每个 source 提供了一个候选对象的（有序）集合。比如前边提到的 file/rec，内置的 source 还包括比如 colorscheme、buffer、command 等。source 可以有参数，在执行 <code>:Denite</code> 时，可以传递参数。比如 file/rec，可以接受一个参数作为搜索的目录，如果参数省略，则使用当前目录。除了参数，source 还可以通过 <code>denite#custom#var</code> 自定义一些变量（variable）。比如</p>
<pre data-lang="vim" style="background-color:#f9f9f9;color:#111111;" class="language-vim "><code class="language-vim" data-lang="vim"><span>call </span><span style="color:#4271ae;">denite#custom#var</span><span>(</span><span style="color:#839c00;">&#39;file/rec&#39;</span><span>, </span><span style="color:#839c00;">&#39;command&#39;</span><span>, [</span><span style="color:#839c00;">&#39;git&#39;</span><span>, </span><span style="color:#839c00;">&#39;ls-files&#39;</span><span>, </span><span style="color:#839c00;">&#39;-co&#39;</span><span>, </span><span style="color:#839c00;">&#39;--exclude-standard&#39;</span><span>])
</span></code></pre>
<p>这行代码自定义了 file/rec 这个 source 的 <code>command</code> 变量，这个变量是 source 获取文件列表的命令。在 Unix 环境下，默认的是使用 <code>find</code> 的。自定义之后，则变成了 <code>git ls-files -co --exclude-standard</code>。不同的 soruce 的参数以及可以自定义的变量都不同，具体的需要查看文档了。</p>
<h2 id="denite-buffer">denite buffer</h2>
<p>source 收集的对象，都是列在 denite buffer 里，用户可以通过输入来过滤搜索结果。默认的设置下，进入 denite buffer 是处于 Insert 模式，这时用户可以进行输入过滤结果。在 Insert 模式下，输入 <code>&lt;tab&gt;</code>，可以选择一些可用的 action。不同的结果，可用的 action 也不同。结果又不同的类型，比如 file、buffer 等。不同的类型支持不同的 action 集合。</p>
<p>和 vim buffer 一样，denite buffer 也支持自定义 map。当然就不是 vim 默认的定义 map 的方式了。denite 中使用 <code>denite#custom#map</code> 定义 map。来个例子</p>
<pre data-lang="vim" style="background-color:#f9f9f9;color:#111111;" class="language-vim "><code class="language-vim" data-lang="vim"><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;normal&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;tab&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:do_action:preview&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span></code></pre>
<p>这个例子，把 Normal 模式下的 <code>&lt;tab&gt;</code> 键，映射为预览操作。最后的 <code>noremap</code> 和 vim 中的意义一样，因为默认 denite 也会递归的解析映射的定义。定义了映射后，denite buffer 的操作和 vim 就没有区别了。现在 VSCode 中也是可以使用 vim 的，但是只能在编辑区。使用 Ctrl-P 的时候，可能还是不得不依赖方向键。在 denite 里就没有了这个问题。</p>
<h2 id="yu-lan-zhu-ti-de-li-zi">预览主题的例子</h2>
<p>denite 内置了 colorscheme 的 source，收集了所有已安装的主题。本来，在 vim 中切换主题，不是很方便，因为没有预览功能，只能 <code>:color &lt;theme&gt;</code> 选定主题，不合适就继续重复。而 denite 利用 <code>-auto-action=preview</code> 选项，配合 colorscheme source，可以方便的切换主题。</p>
<pre data-lang="vim" style="background-color:#f9f9f9;color:#111111;" class="language-vim "><code class="language-vim" data-lang="vim"><span>:Denite -auto</span><span style="color:#c99e00;">-action=</span><span>preview </span><span style="color:#4271ae;">colorscheme</span><span>`
</span></code></pre>
<p><code>-auto-action=preview</code> 的意思是，对选中的结果，自动执行 preivew 的操作。<code>-auto-action</code> 是 denite 的 option。可以通过 <code>denite#custom#option</code> 设置自定义 option。默认设置下，<code>-auto-action</code> 是空的。</p>
<pre data-lang="vim" style="background-color:#f9f9f9;color:#111111;" class="language-vim "><code class="language-vim" data-lang="vim"><span>call </span><span style="color:#4271ae;">denite#custom#option</span><span>(</span><span style="color:#839c00;">&#39;default&#39;</span><span>, </span><span style="color:#839c00;">&#39;auto_action&#39;</span><span>, </span><span style="color:#839c00;">&#39;preview&#39;</span><span>)
</span></code></pre>
<p>option 的名字需要改一下，去掉前缀的 <code>-</code> 并且把中间的 <code>-</code> 替换为 <code>_</code>。</p>
<h2 id="wo-de-pei-zhi">我的配置</h2>
<pre data-lang="vim" style="background-color:#f9f9f9;color:#111111;" class="language-vim "><code class="language-vim" data-lang="vim"><span style="color:#4271ae;">nnoremap </span><span style="color:#c99e00;">&lt;leader&gt;&lt;space&gt;</span><span> :Denite</span><span style="color:#c99e00;">&lt;space&gt;
</span><span>
</span><span>call </span><span style="color:#4271ae;">denite#custom#alias</span><span>(</span><span style="color:#839c00;">&#39;source&#39;</span><span>, </span><span style="color:#839c00;">&#39;file/rec/git&#39;</span><span>, </span><span style="color:#839c00;">&#39;file/rec&#39;</span><span>)
</span><span>call </span><span style="color:#4271ae;">denite#custom#var</span><span>(</span><span style="color:#839c00;">&#39;file/rec/git&#39;</span><span>, </span><span style="color:#839c00;">&#39;command&#39;</span><span>, [</span><span style="color:#839c00;">&#39;git&#39;</span><span>, </span><span style="color:#839c00;">&#39;ls-files&#39;</span><span>, </span><span style="color:#839c00;">&#39;-co&#39;</span><span>, </span><span style="color:#839c00;">&#39;--exclude-standard&#39;</span><span>])
</span><span style="color:#4271ae;">nnoremap </span><span style="color:#c99e00;">&lt;silent&gt; &lt;C-p&gt;</span><span> :</span><span style="color:#c99e00;">&lt;C-u&gt;</span><span>Denite -auto</span><span style="color:#c99e00;">-action=</span><span>preview 
</span><span>            </span><span style="color:#8959a8;">\</span><span> `</span><span style="color:#4271ae;">finddir</span><span>(</span><span style="color:#839c00;">&#39;.git&#39;</span><span>, </span><span style="color:#839c00;">&#39;;&#39;</span><span>) </span><span style="color:#8959a8;">!= </span><span style="color:#839c00;">&#39;&#39;</span><span> ? </span><span style="color:#839c00;">&#39;file/rec/git&#39;</span><span> : </span><span style="color:#839c00;">&#39;file/rec&#39;</span><span>`</span><span style="color:#c99e00;">&lt;cr&gt;
</span><span style="color:#4271ae;">nnoremap </span><span style="color:#c99e00;">&lt;leader&gt;</span><span>c :</span><span style="color:#c99e00;">&lt;C-u&gt;</span><span>Denite </span><span style="color:#4271ae;">colorscheme</span><span> -auto</span><span style="color:#c99e00;">-action=</span><span>preview</span><span style="color:#c99e00;">&lt;cr&gt;
</span><span style="color:#4271ae;">nnoremap </span><span style="color:#c99e00;">&lt;leader&gt;</span><span>; :</span><span style="color:#c99e00;">&lt;C-u&gt;</span><span>Denite file_mru</span><span style="color:#c99e00;">&lt;cr&gt;
</span><span>
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;insert&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;tab&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:move_to_next_line&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;insert&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;S-tab&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:move_to_previous_line&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;insert&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;C-cr&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:choose_action&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;insert&#39;</span><span>, </span><span style="color:#839c00;">&#39;jj&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:enter_mode:normal&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;normal&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;tab&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:do_action:preview&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>call </span><span style="color:#4271ae;">denite#custom#map</span><span>(</span><span style="color:#839c00;">&#39;normal&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;S-tab&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;&lt;denite:choose_action&gt;&#39;</span><span>, </span><span style="color:#839c00;">&#39;noremap&#39;</span><span>)
</span><span>
</span><span>call </span><span style="color:#4271ae;">denite#custom#option</span><span>(</span><span style="color:#839c00;">&#39;default&#39;</span><span>, </span><span style="color:#839c00;">&#39;winheight&#39;</span><span>, </span><span style="color:#839c00;">&#39;15&#39;</span><span>)
</span></code></pre>
<p>有两点说明下。其中 file/rec/git 相关，是 denite 的 FAQ 中的方案。因为默认情况下，file/rec 会显示所有目录下的文件，包括 .git 目录，直接用 file/rec 的结果并非期望的结果，所以当存在 .git 目录时，用 <code>git ls-files</code> 获取文案列表。配置中使用了一个 file_mru 的 source，提供的是最近使用的文件的列表，这个 source 不是 denite 内置的，是由插件 neomru 提供的，与 denite 是同一个作者 Shougo。</p>
<h1 id="zong-jie">总结</h1>
<p>denite 的配置难度比较高，但是配置好之后，用起来就非常顺手。另外，neovim 一个很重也好的发展方向，就是 embeded everywhere，也就是嵌入各种地方。给 neovim 套一个更现代的一个壳，是我对 neovim 的一个非常大的期待。而 denite 给现代的壳，提供了一个非常好的实现 Ctrl-P 的方式。</p>

    </div>
</div>


<span id="comments"></span>
<script src="https://utteranc.es/client.js"
        repo="iEverX/ieverx.github.io"
        issue-term="pathname"
            label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>




    <div class="navigation">
            <span class="prev"></span>
        
            <span class="next"></span>
        
    </div>


        </div>
    </div>
        
<div id="footer">
    <div class="footer-container">
        <div class="copyright" >
            <span> &copy; 2012 - 2024</span>
            &hearts;
            <span class="author">天外天</span>
        </div>
        <div class="support">
            <span class="powered-by">本站由 <a href="https://getzola.org" target="_blank">zola</a> 驱动</span>
            &middot;
            <span class="theme">采用 <a href="https://github.com/ieverx/zola-theme-ink" target="_blank">ink</a> 主题</span>
        </div>
    </div>
</div>

    
        
    <!-- Google Analytics -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54098391-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-54098391-1');
    </script>
    <!-- End Google Analytics -->


    
</body>
</html>
